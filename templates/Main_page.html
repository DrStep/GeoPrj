<!DOCTYPE html>
<html>
  <head>
<meta charset="utf-8" />
    <title>Remove Markers</title>
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
<script type="text/javascript" src="markerclusterer.js"></script>
<script type="text/javascript" src="jquery-1.9.1.js"></script>
 <script type="text/javascript" src="jquery-ui-1.10.3.custom.min.js"></script>
 <script type="text/javascript" src="data.json"></script>
<script type="text/javascript">
var chatCheck=false;
var startWidth=true;
var openCheck=false;
var prevId = '';

$(document).ready(init); 
function init(){ 
	$(".chat").draggable({containment:'window'}); 
}

function openDiv (id) {
	if (openCheck) {
		$('#friend_block').fadeOut(100);
		$('#event_block').fadeOut(100);
		$("#"+prevId).animate({width:'-=1260px'},500);
		$('#'+id).css({display:'block'});
		if (id==prevId) {
			$('#'+id).animate({width:'+=1260px'},500);
		}
		else {
			$('#'+id).delay(500).animate({width:'+=1260px'},500);
		}
	}
	else{
		$(".brd").css({width:'0px'});
		$('#friend_block').css({display:'none'}); 
		$('#event_block').css({display:'none'}); 
		$('#'+id).css({display:'block'});
		$('#'+id).animate({width:'+=1260px'},500);
	}
	if (openCheck) {
		$('#friend_block').delay(800).fadeIn(100);
		$('#event_block').delay(800).fadeIn(100);
	}
	else { 
		$('#friend_block').delay(400).fadeIn(100);
		$('#event_block').delay(400).fadeIn(100);
	} 
	openCheck = true;
	prevId = id;
};

function closeDiv(){
	$('#friend_block').fadeOut(100);
	$('#event_block').fadeOut(100);
	$(".brd").animate({width:'-=1260px'},500);
	$(".brd").queue(function(){
		$(".brd").css({display:'none'});
		$(this).dequeue();	
	});
	openCheck = false;
}

function startChat(){
	if (chatCheck==false){
		$('#delete').animate({width:'-=40px'},200);
		$('#delete').text('Удалить..');
		$('#recommend').animate({width:'-=80px'},200);
		$('#recommend').text('Порекомендовать..');
		$('.brd').delay(50).animate({width:'-=180px'},100);
		$('.chat').delay(50).fadeIn(100);
		chatCheck=true;
	}
	else{
		$('.chat').fadeOut(10);
		$('.brd').animate({width:'+=180px'},200);
		$('#delete').animate({width:'+=40px'},200);
		$('#recommend').animate({width:'+=80px'},200);
		$("#delete").queue(function(){
			$('#delete').text('Удалить из друзей');
			$('#recommend').text('Порекомендовать мероприятие/место');
			$(this).dequeue();
		});
		chatCheck=false;
	}
};

function messageCheck(){
	$(".brd").fadeOut(200);
	$('#on-button').fadeIn(200);
	$('.chat').fadeIn(0);
	$('.chat').animate({height:'0px'},0);
	$('.chat').animate({height:'+=200px'},150);
	chatCheck=true;
}

</script>
    <script>
// In the following example, markers appear when the user clicks on the map.
// The markers are stored in an array.
// The user can then click an option to hide, show or delete the markers.
//var map;
var markers = [];
var _f_first=1;
var overlay;
var map;
var coordinates;
USGSOverlay.prototype = new google.maps.OverlayView();

function initialize() {
  var haightAshbury = new google.maps.LatLng(55.756136,37.616265);
  var mapOptions = {
    zoom: 10,
    center: haightAshbury,
    mapTypeId: google.maps.MapTypeId.ROADMAP,
    mapTypeControl: false,
    zoomControl: false,

    panControl: false,
    rotateControl: false,
    overviewMapControl: false
  };
  map = new google.maps.Map(document.getElementById('map-canvas'),
      mapOptions);

  var srcImage = 'https://developers.google.com/maps/documentation/javascript/';
  srcImage += 'examples/full/images/talkeetna.png';
  google.maps.event.addListener(map, 'click', function(event) {
      overlay.setMap(null); 
  });
  google.maps.event.addListener(map, 'rightclick', function(event) {
    //addMarker(event.latLng);
    if (map) {
     if (_f_first)
     {
        overlay = new USGSOverlay(event.latLng, srcImage, map);
        _f_first=0;
     } else {
        overlay.setMap(null); 
        overlay = new USGSOverlay(event.latLng, srcImage, map);
   }
 }
  });

  google.maps.event.addListener(map, 'zoom_changed', function(event) {
     redraw();
  });
 
 //!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

  google.maps.event.addListener(map,'drag', function(event) {
       //здесь я плучаю некторые данные, в теории тут будет ajax выхов функции, пока не делаю, ибо она все равно ничего не получит, пока просто получаем захордкоженный массив с json координатами объектов.
         clearMarkers();
         for (var i = 0; i < 100; i++) {
          var dataPhoto = data.photos[i];
          var latLng = new google.maps.LatLng(dataPhoto.latitude,
              dataPhoto.longitude)
          addMarker(latLng);
         }
         redraw();
         //markerclusterer

  });
  //!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

  var contentString = '<div id="content">'+
      'aaaaaaaaaaaaaa' + 
      '</div>';

  var infowindow = new google.maps.InfoWindow({
      content: contentString
  });

  var marker = new google.maps.Marker({
      position: myLatlng,
      map: map,
      title: 'Uluru (Ayers Rock)',
      content: "ololo"
  });
  google.maps.event.addListener(marker, 'click', function() {
    infowindow.open(map,marker);
  });
}

function USGSOverlay(location, image,map) {
  // Now initialize all properties.
  coordinates = location;
  this.bounds_ = location;
  this.image_ = image;
  this.map_ = map;

  this.div_ = null;

  this.setMap(map);
}

USGSOverlay.prototype.onAdd = function(location) {
  //alert(coordinates);
  var div = document.createElement('div');
  div.setAttribute('id', 'drop-down');
  //div.innerHTML="<input type='button' class='button_rightclick' value='add meeting' onclick=addMarker(coordinates)>"
  div.innerHTML="<div class='label_rightclick'><a onclick='addMarker(coordinates)'> add meeting </a>"+"<a onclick='addMarker(coordinates)'>check</a></div>";
  this.div_ = div;

  // Add the element to the "overlayImage" pane.
  var panes = this.getPanes();
  panes.overlayImage.appendChild(this.div_);
};

 USGSOverlay.prototype.draw = function() {
  // We use the south-west and north-east
  // coordinates of the overlay to peg it to the correct position and size.
  // To do this, we need to retrieve the projection from the overlay.
  
  // Retrieve the south-west and north-east coordinates of this overlay
  // in LatLngs and convert them to pixel coordinates.
  // We'll use these coordinates to resize the div.
 /*  var tileCoordinate = new GPoint();
   var tilePoint = new GPoint();
    var currentProjection = G_NORMAL_MAP.getProjection();
    tilePoint = currentProjection.fromLatLngToPixel(latlng, map.getZoom());

   tileCoordinate.x = Math.floor(tilePoint.x / 256);
   tileCoordinate.y = Math.floor(tilePoint.y / 256)
   alert(latlng);*/
  // Resize the image's div to fit the indicated dimensions.
  var overlayProjection = this.getProjection();

  // Retrieve the south-west and north-east coordinates of this overlay
  // in LatLngs and convert them to pixel coordinates.
  // We'll use these coordinates to resize the div.
  //alert(this.bounds_.getNorthEast())
  var sw = overlayProjection.fromLatLngToDivPixel(this.bounds_);
  //var ne = overlayProjection.fromLatLngToDivPixel(this.bounds_.);
  var div = this.div_;
  div.style.left = sw.x + 'px';
  div.style.top = sw.y + 'px';
  div.style.width = 120 + 'px';
  div.style.height = 250 + 'px';
}; 

USGSOverlay.prototype.onRemove = function() {
  this.div_.parentNode.removeChild(this.div_);
};

// [START region_hideshow]
// Set the visibility to 'hidden' or 'visible'.
USGSOverlay.prototype.hide = function() {
  if (this.div_) {
    // The visibility property must be a string enclosed in quotes.
    this.div_.style.visibility = 'hidden';
  }
};

USGSOverlay.prototype.show = function() {
  if (this.div_) {
    this.div_.style.visibility = 'visible';
  }
};

USGSOverlay.prototype.toggle = function() {
  if (this.div_) {
    if (this.div_.style.visibility == 'hidden') {
      this.show();
    } else {
      this.hide();
    }
  }
};

// Detach the map from the DOM via toggleDOM().
// Note that if we later reattach the map, it will be visible again,
// because the containing <div> is recreated in the overlay's onAdd() method.
USGSOverlay.prototype.toggleDOM = function() {
  if (this.getMap()) {
    // Note: setMap(null) calls OverlayView.onRemove()
    this.setMap(null);
  }
};




function redraw() {
    var markerCluster = new MarkerClusterer(map, markers);
}
var markerImage = new google.maps.MarkerImage(
            'bg-num.png',
            //  '/home/philipp/bg-num.png',
            new google.maps.Size(33,33),
            new google.maps.Point(0,0),
            new google.maps.Point(0,33)
        );
// Add a marker to the map and push to the array.
function addMarker(location) {
  var marker = new google.maps.Marker({
    icon: markerImage,
    position: location,
    map: map
  });
  //redraw();
  markers.push(marker);
}


// Sets the map on all markers in the array.
function setAllMap(map) {
  for (var i = 0; i < markers.length; i++) {
    markers[i].setMap(map);
  } 
}

// Removes the markers from the map, but keeps them in the array.
function clearMarkers() {
  setAllMap(null);
  markers = [];
}

// Shows any markers currently in the array.
function showMarkers() {
  setAllMap(map);
}

// Deletes all markers in the array by removing references to them.
function deleteMarkers() {
  clearMarkers();
  markers = [];
}

google.maps.event.addDomListener(window, 'load', initialize);

    </script>
<link rel="stylesheet" type="text/css" href="main_page.css">
  </head>
  <body>
    <div id="panel">
      <input onclick="clearMarkers();" type=button value="Hide Markers">
      <input onclick="showMarkers();" type=button value="Show All Markers">
      <input onclick="deleteMarkers();" type=button value="Delete Markers">
    </div>
<div>
<input type="checkbox" id="on-check" name="on-check" />
	 <label id="on-button" for="on-check">
	 <span><span class="ss-plus"></span></span>
	 <span><span class="ss-hyphen"><img src="2.jpg"></span></span>
	 </label>
</div> 
<div class="faux-shadow"> </div>

<div class="chat">
	<div id="income">
	</div>
	<textarea id="yourtext">
	</textarea>
</div>

<ul id="avatar_menu">
   <li id="li1"><a href="#"><img src="1.png"></a></li>
   <li id="li2"><a href="#"><img src="1.png"></a></li>
   <li id="li3"><a href="#friends"><img src="1.png"></a></li>
   <li id="li4"><a href="#events"><img src="1.png"></a></li>
</ul>

<ul id="menu">
   <li id="m1"><a href="#">Семиохин&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Степан </a></li>
   <li id="m2"><a href="#" onclick="closeDiv()">Карта</a></li>
   <li id="m3"><a href="#friends" onClick="openDiv('friends')">Друзья</a></li>
   <li id="m4"><a href="#events" onClick="openDiv('events')">События</a></li>
   <li id="m5"><a href="#meetings" onClick="openDiv('meetings')">Встречи</a></li>
   <li id="m6"><a href='#' onClick="messageCheck()">Выход</a></li>
</ul>

<div class="brd" id="friends">
   <div id="one_friend">
     <div id="circle_mini"></div> 
     <div id="friend_block">   
     <div>
        <span id="friend_font">Дмитрий Петров</span>
        <button class="button_friend" onclick="startChat()">Начать чат</button>
     </div>  
     <div >
        <button class="button_friend">Пригласить...</button>
        <button class="button_friend" id="recommend">Порекомендовать мероприятие/место</button>
        <button class="button_friend" id="delete">Удалить из друзей</button>
     </div>   
</div>
</div>  

</div>

<div class="brd" id="events">
   <div id="one_event">
     <div id="event_square"></div> 
     <div id="event_block">   
     <div>
        <span id="event_font">Концерт группы Metallica</span>
        <button class="button_event">Присоединиться</button>
     </div>  
     <div >
        <button class="button_event">Поставить напоминание о мероприятии</button>
        <button class="button_event">Не интересует</button>
     </div>   
</div>
</div>  

</div>

<div class="brd" id="meetings">
    <h3>Заголовок3</h3>
</div>
    <div id="map-canvas"></div>
  </body>
</html>
